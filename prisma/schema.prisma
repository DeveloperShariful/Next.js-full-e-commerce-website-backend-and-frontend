// ==========================================
// 1. CONFIGURATION
// ==========================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================
// 2. ENUMS
// ==========================================

enum Role {
  SUPER_ADMIN
  ADMIN
  MANAGER
  EDITOR
  SUPPORT
  CUSTOMER
}

enum ProductType {
  SIMPLE
  VARIABLE
  VIRTUAL
  DOWNLOADABLE
  BUNDLE
  GIFT_CARD
}

enum ProductStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

enum OrderStatus {
  DRAFT
  PENDING
  AWAITING_PAYMENT
  PROCESSING
  PACKED
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
  FAILED
  RETURNED
  READY_FOR_PICKUP
}

enum PaymentStatus {
  UNPAID
  PAID
  PARTIALLY_REFUNDED
  REFUNDED
  VOIDED
}

enum FulfillmentStatus {
  UNFULFILLED
  PARTIALLY_FULFILLED
  FULFILLED
  RETURNED
  PICKED_UP
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
  FREE_SHIPPING
  BUY_X_GET_Y
  FIXED_CART
  FIXED_PRODUCT
}

enum ReturnStatus {
  REQUESTED
  APPROVED
  REJECTED
  RECEIVED
  REFUNDED
}

enum TransactionType {
  SALE
  REFUND
  VOID
  DISPUTE
  CHARGEBACK
}

enum BackorderStatus {
  DO_NOT_ALLOW
  ALLOW
  ALLOW_BUT_NOTIFY
}

enum TaxStatus {
  TAXABLE
  SHIPPING_ONLY
  NONE
}

enum AddressType {
  BILLING
  SHIPPING
}

enum MediaType {
  IMAGE
  VIDEO
  DOCUMENT
  ARCHIVE
}

enum ShippingMethodType {
  FLAT_RATE
  FREE_SHIPPING
  LOCAL_PICKUP
  CARRIER_CALCULATED
}

enum PaymentMode {
  TEST
  LIVE
}

enum PaymentIntent {
  CAPTURE
  AUTHORIZE
}

enum PayPalButtonColor {
  GOLD
  BLUE
  SILVER
  WHITE
  BLACK
}

enum PayPalButtonShape {
  PILL
  RECT
}

enum PayPalButtonLayout {
  VERTICAL
  HORIZONTAL
}

enum PayPalButtonLabel {
  PAYPAL
  CHECKOUT
  BUYNOW
  PAY
}

enum PayPalLandingPage {
  LOGIN
  BILLING
  NO_PREFERENCE
}

enum PaymentHandlerType {
  ONLINE
  OFFLINE
}

enum DisputeStatus {
  WARNING_NEEDS_RESPONSE
  NEEDS_RESPONSE
  UNDER_REVIEW
  WON
  LOST
}

// ==========================================
// 3. USER, AUTH & SYSTEM
// ==========================================

model User {
  id              String    @id @default(uuid())
  clerkId         String?   @unique
  name            String?
  email           String    @unique
  emailVerified   DateTime?
  password        String?
  phone           String?   @unique
  image           String?
  role            Role      @default(CUSTOMER)
  isActive        Boolean   @default(true)

  dateOfBirth     DateTime?
  gender          String?
  notes           String?
  metafields      Json?
  deletedAt       DateTime?

  accounts        Account[]
  sessions        Session[]
  addresses       Address[]
  paymentMethods  UserPaymentMethod[]
  orders          Order[]
  reviews         Review[]
  wishlist        Wishlist[]
  cart            Cart?
  viewedProducts  RecentlyViewed[]
  wallet          Wallet?
  abandonedCheckouts AbandonedCheckout[]
  
  activityLogs    ActivityLog[]
  blogPosts       BlogPost[]
  notifications   Notification[]
  
  createdTickets  SupportTicket[] @relation("UserCreatedTickets")
  assignedTickets SupportTicket[] @relation("StaffTickets")

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([email, phone])
  @@index([role])
}

model Account {
  id                String  @id @default(uuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  id      String   @id @default(uuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model PasswordResetToken {
  id      String   @id @default(uuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model UserPaymentMethod {
  id                String   @id @default(uuid())
  userId            String
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  gateway           String   
  type              String   

  gatewayCustomerId String? 
  paymentMethodId   String   
  
  fingerprint       String?
  paypalEmail       String?
  billingAgreementId String?

  brand             String?  
  last4             String?  
  expiryMonth       Int?
  expiryYear        Int?

  billingDetails    Json?    
  isDefault         Boolean  @default(false)

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([userId])
}

model Address {
  id                    String      @id @default(uuid())
  userId                String
  user                  User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  title                 String?     
  type                  AddressType @default(SHIPPING)
  firstName             String
  lastName              String
  company               String?
  address1              String
  address2              String?
  city                  String
  state                 String?     
  postcode              String
  country               String      
  phone                 String
  email                 String?
  
  locationType          String?     
  transdirectLocationId String?
  isResidential         Boolean     @default(true)

  isDefault             Boolean     @default(false)
  taxZoneId             String?     
  isVerified            Boolean     @default(false) 

  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt

  @@index([userId])
}

model Wallet {
  id           String            @id @default(uuid())
  userId       String            @unique
  user         User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  balance      Float             @default(0.00) 
  points       Int               @default(0)    
  transactions WalletTransaction[]
  
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
}

model WalletTransaction {
  id          String          @id @default(uuid())
  walletId    String
  wallet      Wallet          @relation(fields: [walletId], references: [id], onDelete: Cascade)
  amount      Float
  type        TransactionType 
  description String?
  reference   String?         
  createdAt   DateTime        @default(now())

  @@index([walletId])
}

// ==========================================
// 4. PRODUCT CATALOG & I18N
// ==========================================

model Category {
  id          String     @id @default(uuid())
  name        String
  slug        String     @unique
  description String?    @db.Text
  image       String?    
  isActive    Boolean    @default(true)
  menuOrder   Int        @default(0) 

  parentId    String?
  parent      Category?  @relation("CategoryToCategory", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryToCategory")

  products    Product[]
  translations CategoryTranslation[]

  metafields  Json?
  metaTitle   String?
  metaDesc    String?
  deletedAt   DateTime?

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@index([parentId])
}

model CategoryTranslation {
  id          String   @id @default(uuid())
  categoryId  String
  category    Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  language    String   
  name        String
  description String?  @db.Text
  metaTitle   String?
  metaDesc    String?

  @@unique([categoryId, language])
}

model Brand {
  id              String   @id @default(uuid())
  name            String
  slug            String   @unique
  logo            String?  
  description     String?  @db.Text
  website         String?
  countryOfOrigin String?

  products        Product[]
  productAttributes ProductAttribute[]

  metaTitle       String?
  metaDesc        String?
  metafields      Json?
  deletedAt       DateTime?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Tag {
  id       String    @id @default(uuid())
  name     String    @unique
  slug     String?   @unique
  products Product[]
}

model Collection {
  id          String    @id @default(uuid())
  name        String
  slug        String    @unique
  description String?   @db.Text
  image       String?   
  isActive    Boolean   @default(true)
  startDate   DateTime? 
  endDate     DateTime?
  products    Product[]

  metaTitle   String?
  metaDesc    String?

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model ShippingClass {
  id          String    @id @default(uuid())
  name        String
  slug        String    @unique
  description String?
  products    Product[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Product {
  id                 String          @id @default(uuid())
  productCode        Int             @unique @default(autoincrement())
  name               String
  slug               String          @unique
  description        String?         @db.Text
  shortDescription   String?         @db.Text

  productType        ProductType     @default(SIMPLE)
  status             ProductStatus   @default(DRAFT)
  isFeatured         Boolean         @default(false)
  
  categoryId         String?
  category           Category?       @relation(fields: [categoryId], references: [id])
  brandId            String?
  brand              Brand?          @relation(fields: [brandId], references: [id])

  tags               Tag[]
  collections        Collection[]

  featuredImage      String?        
  images             ProductImage[] 
  videoUrl           String?
  videoThumbnail     String?

  price              Float           @default(0.00)
  salePrice          Float?
  saleStart          DateTime?
  saleEnd            DateTime?
  costPerItem        Float?          

  taxable            Boolean         @default(true)
  taxStatus          TaxStatus       @default(TAXABLE)
  taxRateId          String?
  taxRate            TaxRate?        @relation(fields: [taxRateId], references: [id])
  taxClassId         String?         

  sku                String?         @unique
  barcode            String?         
  mpn                String?         
  trackQuantity      Boolean         @default(true) 
  stock              Int             @default(0)     
  lowStockThreshold  Int             @default(2)
  backorderStatus    BackorderStatus @default(DO_NOT_ALLOW)
  soldIndividually   Boolean         @default(false) 

  weight             Float?          @default(0)
  length             Float?
  width              Float?
  height             Float?
  weightUnit         String?         @default("kg")   
  dimensionUnit      String?         @default("cm")   

  shippingClassId    String?
  shippingClass      ShippingClass?  @relation(fields: [shippingClassId], references: [id])

  isVirtual          Boolean         @default(false)
  isDownloadable     Boolean         @default(false)
  downloadFiles      DigitalFile[]
  downloadLimit      Int?           
  downloadExpiry     Int?           
  
  isDangerousGood    Boolean         @default(false)
  dangerousGoodType  String?
  hsCode             String?
  countryOfManufacture String?

  bundleItems        BundleItem[]    @relation("BundleParent") 
  partOfBundles      BundleItem[]    @relation("BundleChild")  

  attributes         ProductAttribute[]
  variants           ProductVariant[]

  reviews            Review[]
  questions          QuestionAnswer[]
  inventoryLevels    InventoryLevel[]

  translations       ProductTranslation[]

  upsellIds          String[]        
  crossSellIds       String[]        

  metaTitle          String?
  metaDesc           String?
  seoCanonicalUrl    String?
  seoSchema          Json?
  gender             String?         
  ageGroup           String?         

  viewCount          Int             @default(0)
  soldCount          Int             @default(0)
  rating             Float           @default(0)
  reviewCount        Int             @default(0)

  metafields         Json?
  menuOrder          Int             @default(0)
  purchaseNote       String?         
  enableReviews      Boolean         @default(true)
  deletedAt          DateTime?

  wishlistedBy       Wishlist[]
  recentViews        RecentlyViewed[]
  orderItems         OrderItem[]

  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt

  @@index([slug])
  @@index([categoryId, status])
  @@index([brandId, status])
  @@index([status])
  @@index([price])
}

model ProductTranslation {
  id               String   @id @default(uuid())
  productId        String
  product          Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  language         String   
  name             String
  description      String?  @db.Text
  shortDescription String?  @db.Text
  metaTitle        String?
  metaDesc         String?

  @@unique([productId, language])
}

model ProductImage {
  id        String   @id @default(uuid())
  url       String   
  altText   String?  
  position  Int      @default(0) 

  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  mediaId   String?  
  media     Media?   @relation(fields: [mediaId], references: [id])

  variantId String?
  variant   ProductVariant? @relation(fields: [variantId], references: [id])
}

model DigitalFile {
  id        String   @id @default(uuid())
  name      String   
  url       String   
  fileSize  String?  
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  accessCount Int    @default(0) 
  createdAt   DateTime @default(now())
}

model BundleItem {
  id              String  @id @default(uuid())
  parentProductId String
  parentProduct   Product @relation("BundleParent", fields: [parentProductId], references: [id], onDelete: Cascade)
  childProductId  String
  childProduct    Product @relation("BundleChild", fields: [childProductId], references: [id])
  quantity        Int     @default(1) 
}

// ==========================================
// 5. ATTRIBUTES & VARIANTS
// ==========================================

model Attribute {
  id        String   @id @default(uuid())
  name      String   @unique
  slug      String   @unique
  type      String   @default("TEXT") 
  values    String[] 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProductAttribute {
  id         String   @id @default(uuid())
  name       String   
  position   Int      @default(0)
  visible    Boolean  @default(true) 
  variation  Boolean  @default(true) 
  isFeatured Boolean  @default(false) 

  brandId    String?
  brand      Brand?   @relation(fields: [brandId], references: [id])

  values     String[] 
  productId  String
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
}

model ProductVariant {
  id              String           @id @default(uuid())
  productId       String
  product         Product          @relation(fields: [productId], references: [id], onDelete: Cascade)

  name            String   
  sku             String?
  barcode         String?
  price           Float
  salePrice       Float?
  costPerItem     Float?

  stock           Int              @default(0)
  trackQuantity   Boolean          @default(true)

  image           String?  
  images          ProductImage[] 

  weight          Float?
  length          Float?
  width           Float?
  height          Float?

  attributes      Json       
  metafields      Json?

  inventoryLevels InventoryLevel[]
  wishlistedBy    Wishlist[]
  recentViews     RecentlyViewed[]

  @@index([productId])
  @@index([sku])
}

// ==========================================
// 6. INVENTORY & WAREHOUSING
// ==========================================

model Location {
  id              String   @id @default(uuid())
  name            String   
  address         String?
  isDefault       Boolean  @default(false) 
  isActive        Boolean  @default(true)
  
  inventoryLevels InventoryLevel[]
  stockTransfers  StockTransfer[]  @relation("FromLocation") 
  stockReceived   StockTransfer[]  @relation("ToLocation")   

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model PickupLocation {
  id           String   @id @default(uuid())
  name         String
  address      String
  city         String
  state        String?
  postcode     String
  country      String   @default("AU")
  instructions String?  
  isActive     Boolean  @default(true)
  orders       Order[]

  latitude     Float?
  longitude    Float?

  openingHours Json?    
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model InventoryLevel {
  id          String          @id @default(uuid())
  quantity    Int             @default(0)
  locationId  String
  location    Location        @relation(fields: [locationId], references: [id])
  productId   String
  product     Product         @relation(fields: [productId], references: [id])
  variantId   String?         
  variant     ProductVariant? @relation(fields: [variantId], references: [id])

  @@unique([locationId, productId, variantId])
  @@index([productId, variantId])
}

model Supplier {
  id            String   @id @default(uuid())
  name          String
  email         String?
  phone         String?
  address       String?
  website       String?
  contactPerson String?
  purchaseOrders PurchaseOrder[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model PurchaseOrder {
  id          String   @id @default(uuid())
  poNumber    String   @unique
  supplierId  String
  supplier    Supplier @relation(fields: [supplierId], references: [id])
  status      String   
  totalCost   Float
  notes       String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([supplierId])
}

model StockTransfer {
  id             String   @id @default(uuid())
  reference      String   @unique 
  fromLocationId String
  fromLocation   Location @relation("FromLocation", fields: [fromLocationId], references: [id])
  toLocationId   String
  toLocation     Location @relation("ToLocation", fields: [toLocationId], references: [id])
  status         String   
  items          Json     
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

// ==========================================
// 7. SALES, ORDERS & RETURNS
// ==========================================

model Order {
  id                 String            @id @default(uuid())
  orderNumber        String            @unique
  orderDate          DateTime          @default(now()) 

  userId             String?
  user               User?             @relation(fields: [userId], references: [id])
  guestEmail         String?            

  status             OrderStatus       @default(PENDING)
  paymentStatus      PaymentStatus     @default(UNPAID)
  fulfillmentStatus  FulfillmentStatus @default(UNFULFILLED)

  currency           String            @default("AUD")
  exchangeRate       Float             @default(1.0)

  subtotal           Float             
  discountTotal      Float             @default(0)
  shippingTotal      Float             @default(0)
  taxTotal           Float             @default(0)
  surcharge          Float             @default(0)        
  total              Float             
  paymentFee         Float             @default(0)
  netAmount          Float             @default(0)

  refundedAmount     Float             @default(0)
  netTotal           Float             @default(0)        

  paymentGateway     String?            
  paymentMethod      String?            
  paymentId          String?           @unique 
  payerId            String?            
  paymentVerified    Boolean           @default(false)    

  invoiceNumber      String?
  invoiceUrl         String?

  couponCode         String?
  discountId         String?
  discount           Discount?         @relation(fields: [discountId], references: [id])
  discountDetails    Json?             

  shippingAddress    Json
  billingAddress     Json

  shippingMethod     String?            
  shippingType       ShippingMethodType @default(FLAT_RATE)
  shippingTrackingNumber String?
  shippingTrackingUrl String?
  shippingProvider   String?            

  pickupLocationId   String?
  pickupLocation     PickupLocation?   @relation(fields: [pickupLocationId], references: [id])

  transdirectBookingId Int?
  transdirectOrderStatus String?
  transdirectQuoteId   String?
  transdirectBookingRef String?
  
  authorityToLeave   Boolean  @default(false)
  tailgatePickup     Boolean  @default(false)
  tailgateDelivery   Boolean  @default(false)
  declaredValue      Float?
  isInsured          Boolean  @default(false)
  
  selectedCourierCode String?  
  selectedCourierService String?
  quoteTier          Int?     @default(1)
  pickupDate         DateTime?
  pickupReadyTime    String?
  pickupCloseTime    String?
  
  transdirectLabelUrl String?
  transdirectInvoiceUrl String?

  customerNote       String?
  adminNote          String?
  deliveryInstructions String?
  estimatedTransitTime String?

  ipAddress          String?
  userAgent          String?
  paymentIntentId    String?            
  chargeId           String?            
  isAuthorized       Boolean           @default(false)    
  isCaptured         Boolean           @default(false)
  capturedAt         DateTime?

  riskLevel          String?
  riskScore          Int?
  fraudAnalysis      Json?

  items              OrderItem[]
  shipments          Shipment[]
  transactions       OrderTransaction[]
  refunds            Refund[]
  returns            ReturnRequest[]
  disputes           Dispute[]
  orderNotes         OrderNote[]

  deletedAt          DateTime?

  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  @@index([userId, status])
  @@index([createdAt, status])
  @@index([status])
  @@index([paymentId])
  @@index([orderNumber])
  @@index([orderDate])
}

model OrderItem {
  id           String   @id @default(uuid())
  orderId      String
  order        Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  productId    String?
  product      Product? @relation(fields: [productId], references: [id], onDelete: SetNull) 

  productName  String   
  variantId    String?
  variantName  String?  
  sku          String?  
  image        String?  

  price        Float    
  quantity     Int
  total        Float    
  tax          Float    @default(0) 

  metadata     Json?    

  @@index([orderId])
  @@index([productId, variantId])
}

model OrderTransaction {
  id            String   @id @default(uuid())
  orderId       String
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  gateway       String   
  type          TransactionType
  amount        Float
  currency      String   @default("AUD")

  transactionId String   
  idempotencyKey String? 

  status        String   

  parentTransactionId String?
  parentTransaction   OrderTransaction? @relation("RefundOf", fields: [parentTransactionId], references: [id])
  refunds             OrderTransaction[] @relation("RefundOf")

  rawResponse   Json?    
  errorCode     String?
  errorMessage  String?

  metadata      Json?    
  createdAt     DateTime @default(now())

  @@index([orderId])
  @@index([transactionId])
}

model Dispute {
  id               String        @id @default(uuid())
  orderId          String
  order            Order         @relation(fields: [orderId], references: [id])
  
  gatewayDisputeId String        @unique 
  reason           String?
  status           DisputeStatus @default(WARNING_NEEDS_RESPONSE)
  amount           Float
  currency         String        @default("AUD")
  
  evidenceDueBy    DateTime?
  metadata         Json?
  
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  @@index([orderId])
}

model Payout {
  id               String    @id @default(uuid())
  gateway          String    
  payoutId         String    @unique 
  amount           Float
  currency         String
  status           String    
  arrivalDate      DateTime  
  
  details          Json?     
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
}

model PaymentWebhookLog {
  id              String   @id @default(uuid())
  provider        String   
  eventId         String   
  eventType       String   
  payload         Json     
  processed       Boolean  @default(false) 
  processingError String?  
  createdAt       DateTime @default(now())

  @@unique([eventId]) 
}

model Shipment {
  id               String   @id @default(uuid())
  orderId          String
  order            Order    @relation(fields: [orderId], references: [id])
  trackingNumber   String?
  trackingUrl      String?
  courier          String?  
  items            Json     
  shippedDate      DateTime @default(now())
  deliveredDate    DateTime?

  transdirectId      Int?      
  connote            String?  
  labelUrl           String?  
  invoiceUrl         String?  
  courierName        String?  
  lastTrackingStatus String?
  
  courierJobId       String?
  manifestId         String?
  numberOfParcels    Int      @default(1)

  syncedToGateway Boolean  @default(false)
  syncError       String?

  @@index([orderId])
}

model ReturnRequest {
  id           String   @id @default(uuid())
  orderId      String
  order        Order    @relation(fields: [orderId], references: [id])
  status       ReturnStatus @default(REQUESTED)
  reason       String   
  adminNote    String?  
  refunded     Boolean  @default(false) 
  items        Json     
  images       String[] 
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([orderId])
}

model Refund {
  id            String   @id @default(uuid())
  orderId       String
  order         Order    @relation(fields: [orderId], references: [id])
  amount        Float    
  reason        String?
  status        String   @default("pending") 

  gatewayRefundId String? 
  metadata        Json?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([orderId])
}

model OrderNote {
  id        String   @id @default(uuid())
  orderId   String
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  content   String
  isSystem  Boolean  @default(false) 
  notify    Boolean  @default(false) 
  createdAt DateTime @default(now())
}

// ==========================================
// 8. CART, WISHLIST & ABANDONED CHECKOUT
// ==========================================

model Cart {
  id              String      @id @default(uuid())
  userId          String?     @unique 
  user            User?       @relation(fields: [userId], references: [id])
  sessionId       String?     
  items           CartItem[]

  reminderSentAt  DateTime?  
  updatedAt       DateTime    @updatedAt

  @@index([sessionId])
}

model CartItem {
  id        String   @id @default(uuid())
  cartId    String
  cart      Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  productId String
  variantId String?  
  quantity  Int

  @@index([cartId])
}

model AbandonedCheckout {
  id             String   @id @default(uuid())
  cartToken      String?  
  email          String?  
  userId         String?  
  user           User?    @relation(fields: [userId], references: [id])

  items          Json     
  subtotal       Float
  currency       String   @default("AUD")

  recoveryUrl    String   
  isRecovered    Boolean  @default(false) 
  recoveredAt    DateTime?

  remindersSent  Int      @default(0) 
  lastReminder   DateTime?

  ipAddress      String?
  userAgent      String?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([email])
  @@index([isRecovered])
  @@index([userId])
}

model Wishlist {
  id        String          @id @default(uuid())
  userId    String
  user      User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  productId String
  product   Product         @relation(fields: [productId], references: [id], onDelete: Cascade)

  variantId String?
  variant   ProductVariant? @relation(fields: [variantId], references: [id])

  createdAt DateTime        @default(now())

  @@unique([userId, productId, variantId])
  @@index([userId])
}

model RecentlyViewed {
  id        String          @id @default(uuid())
  userId    String
  user      User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  productId String
  product   Product         @relation(fields: [productId], references: [id], onDelete: Cascade)

  variantId String?
  variant   ProductVariant? @relation(fields: [variantId], references: [id])

  viewedAt  DateTime        @default(now())

  @@index([userId])
}

// ==========================================
// 9. MARKETING & DISCOUNTS
// ==========================================

model Discount {
  id               String        @id @default(uuid())
  code             String        @unique 
  description      String?
  type             DiscountType  @default(PERCENTAGE)
  value            Float         

  minSpend         Float?        
  maxSpend         Float?        
  minQty           Int?          

  startDate        DateTime      @default(now())
  endDate          DateTime?
  usageLimit       Int?          
  usagePerUser     Int?          
  usedCount        Int           @default(0) 

  excludeSaleItems Boolean       @default(false) 

  productIds       String[]
  categoryIds      String[]

  ruleLogic        Json?         
  isActive         Boolean       @default(true)

  orders           Order[]       

  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  @@index([code])
  @@index([startDate, endDate])
}

model GiftCard {
  id             String   @id @default(uuid())
  code           String   @unique
  initialValue   Float    
  balance        Float    
  userId         String?  
  recipientEmail String?  
  expiresAt      DateTime?
  isEnabled      Boolean  @default(true)
  createdAt      DateTime @default(now())
}

model Newsletter {
  id        String   @id @default(uuid())
  email     String   @unique
  isActive  Boolean  @default(true) 
  createdAt DateTime @default(now())
}

// ==========================================
// 10. CMS & SYSTEM
// ==========================================

model BlogPost {
  id          String   @id @default(uuid())
  title       String
  slug        String   @unique
  content     String   @db.Text
  excerpt     String?  
  image       String?  
  authorId    String
  author      User     @relation(fields: [authorId], references: [id])
  isPublished Boolean  @default(false)
  tags        String[] 
  metaTitle   String?
  metaDesc    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
}

model Page {
  id          String   @id @default(uuid())
  title       String
  slug        String   @unique
  content     String   @db.Text
  metaTitle   String?
  metaDesc    String?
  isPublished Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Menu {
  id        String      @id @default(uuid())
  title     String      
  slug      String      @unique 
  items     Json        
  isActive  Boolean     @default(true)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
}

model Review {
  id          String   @id @default(uuid())
  rating      Int      
  title       String?
  content     String?  @db.Text
  isVerified  Boolean  @default(false) 
  status      String   @default("pending") 
  images      String[] 

  userId      String
  user        User     @relation(fields: [userId], references: [id])
  productId   String
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  reply       String?  
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([productId])
  @@index([status])
}

model QuestionAnswer {
  id          String   @id @default(uuid())
  question    String
  answer      String?
  productId   String
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  userId      String?  
  isApproved  Boolean  @default(false) 
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([productId])
}

model SupportTicket {
  id             String   @id @default(uuid())
  subject        String
  status         String   @default("open") 
  priority       String   @default("medium") 

  userId         String   
  user           User     @relation("UserCreatedTickets", fields: [userId], references: [id])

  assignedToId   String?  
  assignedTo     User?    @relation("StaffTickets", fields: [assignedToId], references: [id])

  messages       TicketMessage[]
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt 

  @@index([userId])
  @@index([status])
  @@index([assignedToId])
}

model TicketMessage {
  id         String   @id @default(uuid())
  ticketId   String
  ticket     SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  senderId   String   
  message    String   @db.Text
  attachment String?  
  createdAt  DateTime @default(now())
}

// ==========================================
// 11. SETTINGS & ADVANCED CONFIGURATIONS
// ==========================================

model StoreSettings {
  id             String @id @default("settings") 
  storeName      String @default("My Store")
  storeEmail     String?
  storePhone     String?

  currency       String @default("AUD")
  currencySymbol String @default("$")

  storeAddress   Json?  
  taxSettings    Json?  
  generalConfig  Json?  

  weightUnit     String @default("kg")
  dimensionUnit  String @default("cm")

  logo           String?
  favicon        String?

  socialLinks    Json?  
  smtpConfig     Json?  
  maintenance    Boolean @default(false) 
}

// ==========================================
// 12. TAX, SHIPPING & TRANSDIRECT
// ==========================================

model TaxRate {
  id          String    @id @default(uuid())
  name        String    @default("GST") 
  rate        Float     @default(10.0)  
  country     String?   @default("AU")
  state       String?   
  priority    Int       @default(0)     
  compound    Boolean   @default(false) 
  shipping    Boolean   @default(true)  
  class       String    @default("STANDARD") 

  products    Product[] 
  isActive    Boolean   @default(true)
}

model ShippingZone {
  id        String @id @default(uuid())
  name      String 
  countries String[] 
  rates     ShippingRate[] 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ShippingRate {
  id        String @id @default(uuid())
  zoneId    String
  zone      ShippingZone @relation(fields: [zoneId], references: [id])

  name      String 
  type      ShippingMethodType @default(FLAT_RATE) 

  price     Float        
  minWeight Float?       
  maxWeight Float?       
  minPrice  Float?       

  taxStatus             String    @default("taxable") 
  freeShippingRequirement String? 

  carrierServiceId String?
  carrierService   CarrierService? @relation(fields: [carrierServiceId], references: [id]) 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CarrierService {
  id          String   @id @default(uuid())
  name        String   
  slug        String   @unique
  isEnabled   Boolean  @default(false)
  apiKey      String?  
  apiSecret   String?  
  isSandbox   Boolean  @default(true) 
  settings    Json?    
  rates       ShippingRate[] 
  
  shippingPackages ShippingBox[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TransdirectConfig {
  id               String   @id @default("transdirect_config") 
  isEnabled        Boolean  @default(false)
  
  email            String?  
  password         String?  
  apiKey           String?  

  memberId         Int?     
  creditLimit      Float?   
  accountStatus    String?  

  senderName       String?
  senderCompany    String?
  senderPhone      String?
  senderAddress    String?
  senderSuburb     String?
  senderPostcode   String?
  senderState      String?
  senderCountry    String?  @default("AU")
  senderType       String   @default("business") 

  defaultTailgatePickup    Boolean @default(false) 
  defaultTailgateDelivery Boolean @default(false) 
  defaultDeclaredValue     Boolean @default(true) 
  
  defaultPickupReadyTime   String  @default("09:00")
  defaultPickupCloseTime   String  @default("17:00")

  useFrequentRates         Boolean @default(false) 
  enableOrderBoxing        Boolean @default(false) 

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model TransdirectBox {
  id          String   @id @default(uuid())
  code        String?  
  description String?  
  length      Float    
  width       Float    
  height      Float    
  maxWeight   Float?   
  
  isActive    Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ShippingBox {
  id          String   @id @default(uuid())
  name        String   
  
  length      Float    
  width       Float    
  height      Float    
  weight      Float?   
  maxWeight   Float?   
  
  isEnabled   Boolean  @default(true)

  carrierServiceId String?
  carrierService   CarrierService? @relation(fields: [carrierServiceId], references: [id])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ==========================================
// 13. EMAIL & NOTIFICATION SYSTEM
// ==========================================

model EmailConfiguration {
  id              String   @id @default("email_config")
  senderName      String   @default("GoBike")
  senderEmail     String   @default("gobike@gobike.au") 
  smtpHost        String?  
  smtpPort        Int?     @default(587)
  smtpUser        String? 
  smtpPassword    String?  
  encryption      String?  @default("tls") 
  headerImage     String?  
  footerText      String?  @default("Â© 2025 GoBike. All rights reserved.")
  baseColor       String?  @default("#2271b1") 
  backgroundColor String? @default("#F7F7F7") 
  bodyBackgroundColor String? @default("#FFFFFF") 
  
  isActive        Boolean  @default(true)
  updatedAt       DateTime @updatedAt
}

model EmailTemplate {
  id          String   @id @default(uuid())
  slug        String   @unique 
  triggerEvent String? @unique 
  name        String   
  subject     String   
  heading     String?  
  content     String   @db.Text 
  isEnabled   Boolean  @default(true)
  
  recipientType String @default("customer")
  customRecipients String?
  cc          String[] 
  bcc         String[]
  
  attachments String[] 

  emailType   String   @default("html") 
  fromName    String?
  fromEmail   String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model EmailLog {
  id          String   @id @default(uuid())
  recipient   String   
  subject     String   
  templateSlug String? 
  status      String   
  errorMessage String? 
  metadata    Json?
  
  openedAt    DateTime? 
  
  orderId     String?  
  userId      String?  

  createdAt   DateTime @default(now())
  @@index([recipient])
  @@index([status])
}

model ActivityLog {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  action      String   
  entityType  String?  
  entityId    String?  
  details     Json?    
  ipAddress   String?
  createdAt   DateTime @default(now())
}

model Notification {
  id        String   @id @default(uuid())
  userId    String?  
  user      User?    @relation(fields: [userId], references: [id])
  title     String
  message   String
  isRead    Boolean  @default(false)
  link      String?  
  type      String?  
  createdAt DateTime @default(now())

  @@index([userId])
}

model Analytics {
  id          String   @id @default(uuid())
  date        DateTime @default(now()) @db.Date 
  totalSales  Float    @default(0)
  totalOrders Int      @default(0)
  visitors    Int      @default(0)

  @@unique([date]) 
}

model MediaFolder {
  id        String   @id @default(uuid())
  name      String
  parentId  String?
  parent    MediaFolder? @relation("FolderToFolder", fields: [parentId], references: [id])
  children  MediaFolder[] @relation("FolderToFolder")
  files     Media[] 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Media {
  id          String   @id @default(uuid())
  url         String   
  type        MediaType @default(IMAGE) 
  filename    String   
  mimeType    String   
  size        Int      

  altText     String?  
  caption     String?  
  description String?

  folderId    String?
  folder      MediaFolder? @relation(fields: [folderId], references: [id])

  uploadedBy  String   
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  productImages ProductImage[] 
}

model UrlRedirect {
  id        String   @id @default(uuid())
  source    String   @unique 
  target    String   
  code      Int      @default(301) 
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SeoGlobalConfig {
  id               String   @id @default("global_seo")
  siteName         String   @default("GoBike")
  titleSeparator   String   @default("|") 
  siteUrl          String   @default("https://gobike.au")
  organizationData Json?    @db.JsonB 
  defaultMetaTitle String?
  defaultMetaDesc  String?  @db.Text
  defaultKeywords  String[] 
  robotsTxtContent String?  @db.Text 
  globalRobotsProps Json?   
  sitemapEnabled   Boolean  @default(true)
  isPublic         Boolean  @default(true) 
  ogImage          String?  
  ogImageWidth     Int?     @default(1200) 
  ogImageHeight    Int?     @default(630)
  ogType           String   @default("website")
  ogLocale         String   @default("en_AU") 
  twitterCard      String   @default("summary_large_image")
  twitterSite      String?  
  twitterCreator   String?  
  themeColor       String?  @default("#2271b1") 
  manifestJson     Json?    

  updatedAt        DateTime @updatedAt
}

model MarketingIntegration {
  id                  String   @id @default("marketing_config")
  gtmEnabled          Boolean  @default(false)
  gtmContainerId      String?  
  gtmAuth             String?  
  gtmPreview          String?  
  dataLayerName       String   @default("dataLayer") 

  gscVerificationCode String? 
  gscServiceAccountJson String? @db.Text 

  gmcMerchantId       String?
  gmcTargetCountry    String   @default("AU")
  gmcLanguage         String   @default("en")
  gmcContentApiEnabled Boolean @default(false)

  fbPixelId           String?
  fbEnabled           Boolean  @default(false)
  fbAccessToken       String?  @db.Text 
  fbTestEventCode     String?  
  fbDataProcessingOptions Json? 
  fbDomainVerification String? 

  klaviyoEnabled      Boolean  @default(false)
  klaviyoPublicKey    String? 
  klaviyoPrivateKey   String?  @db.Text 
  klaviyoListIds      Json?    
  klaviyoTrackViewedProduct Boolean @default(true)
  klaviyoTrackAddedToCart   Boolean @default(true) 

  updatedAt           DateTime @updatedAt
}

model Banner {
  id        String   @id @default(uuid())
  title     String
  image     String   
  link      String?  
  position  Int      @default(0) 
  isActive  Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SystemLog {
  id        String   @id @default(uuid())
  level     String   
  source    String   
  message   String   @db.Text
  context   Json?    
  createdAt DateTime @default(now())

  @@index([source])
  @@index([createdAt])
}

// ==========================================
// 15. PAYMENT CONFIGURATION
// ==========================================

model PaymentMethodConfig {
  id               String   @id @default(uuid())
  identifier       String   @unique 
  name             String   
  isEnabled        Boolean  @default(false)
  
  mode             PaymentMode @default(TEST)

  displayOrder     Int      @default(0) 
  description      String?  
  instructions     String?  
  icon             String?  

  minOrderAmount Float?
  maxOrderAmount Float?

  surchargeEnabled Boolean @default(false)
  surchargeType    String  @default("fixed") 
  surchargeAmount  Float   @default(0)
  taxableSurcharge Boolean @default(false)

  needsSetup       Boolean @default(true)

  stripeConfig     StripeConfig?
  paypalConfig     PaypalConfig?
  offlineConfig    OfflinePaymentConfig?

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model StripeConfig {
  id                    String              @id @default(uuid())
  paymentMethodId       String              @unique
  paymentMethod         PaymentMethodConfig @relation(fields: [paymentMethodId], references: [id], onDelete: Cascade)

  enableStripe          Boolean             @default(true)
  
  testMode              Boolean             @default(false) 
  
  title                 String              @default("Credit Card / Debit Card")
  description           String              @default("Pay securely with your credit card via Stripe.")

  isConnected           Boolean             @default(false)
  accountId             String?             
  oauthAccessToken      String?             @db.Text 
  oauthRefreshToken     String?             @db.Text 
  oauthTokenType        String?             

  livePublishableKey    String?             
  liveSecretKey         String?             
  liveWebhookSecret     String?             
  
  testPublishableKey    String?             
  testSecretKey         String?             
  testWebhookSecret     String?             

  paymentAction         PaymentIntent       @default(CAPTURE) 
  statementDescriptor   String?             
  shortStatementDescriptor String?          
  addOrderNumberToStatement Boolean         @default(false) 

  savedCards            Boolean             @default(true) 
  inlineCreditCardForm  Boolean             @default(true) 
  
  applePayEnabled       Boolean             @default(true)
  googlePayEnabled      Boolean             @default(true)
  paymentRequestButtons Boolean             @default(true) 
  buttonTheme           String              @default("dark") 

  debugLog              Boolean             @default(false)
  updatedAt             DateTime            @updatedAt
}

model PaypalConfig {
  id                    String              @id @default(uuid())
  paymentMethodId       String              @unique
  paymentMethod         PaymentMethodConfig @relation(fields: [paymentMethodId], references: [id], onDelete: Cascade)

  enablePaypal          Boolean             @default(true)

  sandbox               Boolean             @default(false) 
  
  isOnboarded           Boolean             @default(false)
  merchantId            String?             
  
  accessToken           String?             @db.Text 
  refreshToken          String?             @db.Text
  tokenExpiry           DateTime?
  tokenType             String?             
  partnerReferralId     String?             

  liveEmail             String?             
  liveClientId          String?             
  liveClientSecret      String?             
  
  sandboxEmail          String?
  sandboxClientId       String?
  sandboxClientSecret   String?

  title                 String              @default("PayPal")
  description           String              @default("Pay via PayPal; you can pay with your credit card if you don't have a PayPal account.")
  
  intent                PaymentIntent       @default(CAPTURE) 
  instantPayments       Boolean             @default(false)   
  brandName             String?             
  landingPage           PayPalLandingPage   @default(LOGIN)   
  
  disableFunding        String[]            

  advancedCardEnabled   Boolean             @default(false) 
  advancedCardTitle     String              @default("Debit & Credit Cards")
  
  vaultingEnabled       Boolean             @default(false) 

  smartButtonLocations  String[]            
  requireFinalConfirmation Boolean          @default(true) 

  buttonLabel           PayPalButtonLabel   @default(PAYPAL)
  buttonLayout          PayPalButtonLayout  @default(VERTICAL)
  buttonColor           PayPalButtonColor   @default(GOLD)
  buttonShape           PayPalButtonShape   @default(RECT)

  payLaterEnabled       Boolean             @default(true)
  payLaterLocations     String[]            
  payLaterMessaging     Boolean             @default(true) 
  payLaterMessageTheme  String              @default("light") 

  subtotalMismatchBehavior String           @default("add_line_item") 
  invoicePrefix         String?             @default("wc-")            
  
  debugLog              Boolean             @default(false) 
  webhookId             String?             
  webhookUrl            String?             

  updatedAt             DateTime            @updatedAt
}

model OfflinePaymentConfig {
  id                    String              @id @default(uuid())
  paymentMethodId       String              @unique
  paymentMethod         PaymentMethodConfig @relation(fields: [paymentMethodId], references: [id], onDelete: Cascade)

  bankDetails           Json?               
  chequePayTo           String?
  addressInfo           String?
  enableForShippingMethods String[]         
}